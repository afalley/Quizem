{% extends 'base.html' %}
{% block content %}
  <article>
    <hgroup>
      <h2>{{ quiz.title }}</h2>
      <p>Please answer all questions below and submit your work.</p>
    </hgroup>
    
    <form method="post" action="{{ url_for('submit_quiz', quiz_id=quiz.id) }}">
      <div class="grid">
        <label>
          Your Name
          <input name="student_name" placeholder="Jane Doe" required>
        </label>
        <label>
          Your Email (optional)
          <input type="email" name="student_email" placeholder="you@example.com">
        </label>
      </div>

      <hr style="margin: 2rem 0;">

      {% for q in quiz.questions %}
        {% set q_index = loop.index0 %}
        {% set qtype = (q.type or 'mc')|lower %}
        <fieldset style="margin-bottom: 2rem; border: 1px solid #f1f5f9; padding: 1.5rem; border-radius: 0.75rem;">
          <legend style="font-weight: 700; color: #1e293b; padding: 0 0.5rem;">Question {{ loop.index }}</legend>
          
          <p style="font-size: 1.125rem; margin-bottom: 1.5rem;">{{ q.text }}</p>

          {% if qtype == 'essay' %}
            <label>
              Your Response
              <textarea name="q_{{ q_index }}" rows="8" placeholder="Type your answer here..." required></textarea>
            </label>
            {% if q.requirements %}
              <details>
                <summary style="font-size: 0.875rem; color: #64748b;">Review Grading Requirements</summary>
                <div style="font-size: 0.875rem; color: #64748b; padding-top: 0.5rem;">
                    <ul>
                      {% for r in q.requirements %}
                        <li>{{ r }}</li>
                      {% endfor %}
                    </ul>
                </div>
              </details>
            {% endif %}
          {% else %}
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              {% for opt in q.options %}
                <label style="display: flex; align-items: center; padding: 0.75rem; border: 1px solid #f1f5f9; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s;">
                  <input type="radio" name="q_{{ q_index }}" value="{{ loop.index0 }}" required style="margin-bottom: 0; margin-right: 0.75rem;">
                  {{ opt }}
                </label>
              {% endfor %}
            </div>
          {% endif %}
        </fieldset>
      {% endfor %}

      <footer style="display: flex; gap: 1rem; background: none; border: none; padding: 0; margin-top: 2rem;">
        <button type="submit" id="submit-button" style="flex: 1;">Submit Quiz</button>
        <a role="button" class="outline" href="{{ url_for('index') }}" style="flex: 0 0 auto;">Cancel</a>
      </footer>
    </form>
  </article>

  <style>
    fieldset label:hover {
        background-color: #f8fafc;
        border-color: var(--primary);
    }
    fieldset label:has(input:checked) {
        background-color: var(--primary-focus);
        border-color: var(--primary);
        font-weight: 600;
    }
  </style>

  <script>
    document.querySelector('form').addEventListener('submit', function(e) {
      const btn = document.getElementById('submit-button');
      btn.innerText = 'Submitting & Grading...';
      btn.setAttribute('aria-busy', 'true');
      btn.disabled = true;
    });
  </script>
{% endblock %}
